<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/ticketing.css" />
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <title>Ticketing</title>
    <style>
        @import url('https://webfontworld.github.io/pretendard/Pretendard.css');

        body {
            font-family: 'Pretendard', sans-serif;
        }
    </style>
</head>

<body>
    <button id="backToLogin" class="back-button">&times;</button>
    <h1 class="centered-text" id="welcomeMessage"></h1>
    <h1 class="centered-text">좌석 선택</h1>
    <div class="stage">
        <div class="stage-text">
            <div class="stage-text-inner">
                Stage
            </div>
        </div>
    </div>
    <div class="squares_up">
        <div id="squares">
            <div id="seat_left">
                <div class="firstline">
                    <div class="n" id="n"></div>
                    <div class="n" id="n"></div>
                    <div class="n" id="n"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                </div>
                <div class="firstline">
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                </div>
                <div id="l">
                    <div class="square" id="A0">A0</div>
                    <div class="square" id="A1">A1</div>
                    <div class="square" id="A2">A2</div>
                    <div class="square" id="A3">A3</div>
                    <div class="square" id="A4">A4</div>
                    <div class="square" id="A5">A5</div>
                </div>
                <div id="l">
                    <div class="square" id="B0">B0</div>
                    <div class="square" id="B1">B1</div>
                    <div class="square" id="B2">B2</div>
                    <div class="square" id="B3">B3</div>
                    <div class="square" id="B4">B4</div>
                    <div class="square" id="B5">B5</div>
                </div>
                <div id="l">
                    <div class="square" id="C0">C0</div>
                    <div class="square" id="C1">C1</div>
                    <div class="square" id="C2">C2</div>
                    <div class="square" id="C3">C3</div>
                    <div class="square" id="C4">C4</div>
                    <div class="square" id="C5">C5</div>
                </div>
                <div id="l">
                    <div class="square" id="D0">D0</div>
                    <div class="square" id="D1">D1</div>
                    <div class="square" id="D2">D2</div>
                    <div class="square" id="D3">D3</div>
                    <div class="square" id="D4">D4</div>
                    <div class="square" id="D5">D5</div>
                </div>
                <div id="l">
                    <div class="square" id="E0">E0</div>
                    <div class="square" id="E1">E1</div>
                    <div class="square" id="E2">E2</div>
                    <div class="square" id="E3">E3</div>
                    <div class="square" id="E4">E4</div>
                    <div class="square" id="E5">E5</div>
                </div>
                <div id="l">
                    <div class="square" id="F0">F0</div>
                    <div class="square" id="F1">F1</div>
                    <div class="square" id="F2">F2</div>
                    <div class="square" id="F3">F3</div>
                    <div class="square" id="F4">F4</div>
                    <div class="square" id="F5">F5</div>
                </div>
                <div id="l">
                    <div class="square" id="G0">G0</div>
                    <div class="square" id="G1">G1</div>
                    <div class="square" id="G2">G2</div>
                    <div class="square" id="G3">G3</div>
                    <div class="square" id="G4">G4</div>
                    <div class="square" id="G5">G5</div>
                </div>
                <div id="l">
                    <div class="square" id="H0">H0</div>
                    <div class="square" id="H1">H1</div>
                    <div class="square" id="H2">H2</div>
                    <div class="square" id="H3">H3</div>
                    <div class="square" id="H4">H4</div>
                    <div class="square" id="H5">H5</div>
                </div>
                <div id="l">
                    <div class="square" id="I0">I0</div>
                    <div class="square" id="I1">I1</div>
                    <div class="square" id="I2">I2</div>
                    <div class="square" id="I3">I3</div>
                    <div class="square" id="I4">I4</div>
                    <div class="square" id="I5">I5</div>
                </div>
                <div id="l">
                    <div class="square" id="J0">J0</div>
                    <div class="square" id="J1">J1</div>
                    <div class="square" id="J2">J2</div>
                    <div class="square" id="J3">J3</div>
                    <div class="square" id="J4">J4</div>
                    <div class="square" id="J5">J5</div>
                </div>
            </div>
            <div id="seat_right">
                <div class="firstline">
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                </div>
                <div class="firstline">
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                    <div class="occupied" id="o"></div>
                </div>
                <div id="r">
                    <div class="square" id="A6">A6</div>
                    <div class="square" id="A7">A7</div>
                    <div class="square" id="A8">A8</div>
                    <div class="square" id="A9">A9</div>
                    <div class="square" id="A10">A10</div>
                    <div class="square" id="A11">A11</div>
                </div>
                <div id="r">
                    <div class="square" id="B6">B6</div>
                    <div class="square" id="B7">B7</div>
                    <div class="square" id="B8">B8</div>
                    <div class="square" id="B9">B9</div>
                    <div class="square" id="B10">B10</div>
                    <div class="square" id="B11">B11</div>
                </div>
                <div id="r">
                    <div class="square" id="C6">C6</div>
                    <div class="square" id="C7">C7</div>
                    <div class="square" id="C8">C8</div>
                    <div class="square" id="C9">C9</div>
                    <div class="square" id="C10">C10</div>
                    <div class="square" id="C11">C11</div>
                </div>
                <div id="r">
                    <div class="square" id="D6">D6</div>
                    <div class="square" id="D7">D7</div>
                    <div class="square" id="D8">D8</div>
                    <div class="square" id="D9">D9</div>
                    <div class="square" id="D10">D10</div>
                    <div class="square" id="D11">D11</div>
                </div>
                <div id="r">
                    <div class="square" id="E6">E6</div>
                    <div class="square" id="E7">E7</div>
                    <div class="square" id="E8">E8</div>
                    <div class="square" id="E9">E9</div>
                    <div class="square" id="E10">E10</div>
                    <div class="square" id="E11">E11</div>
                </div>
                <div id="r">
                    <div class="square" id="F0">F6</div>
                    <div class="square" id="F1">F7</div>
                    <div class="square" id="F2">F8</div>
                    <div class="square" id="F3">F9</div>
                    <div class="square" id="F4">F10</div>
                    <div class="square" id="F5">F11</div>
                </div>
                <div id="r">
                    <div class="square" id="G6">G6</div>
                    <div class="square" id="G7">G7</div>
                    <div class="square" id="G8">G8</div>
                    <div class="square" id="G9">G9</div>
                    <div class="square" id="G10">G10</div>
                    <div class="square" id="G11">G11</div>
                </div>
                <div id="r">
                    <div class="square" id="H6">H6</div>
                    <div class="square" id="H7">H7</div>
                    <div class="square" id="H8">H8</div>
                    <div class="square" id="H9">H9</div>
                    <div class="square" id="H10">H10</div>
                    <div class="square" id="H11">H11</div>
                </div>
                <div id="r">
                    <div class="square" id="I6">I6</div>
                    <div class="square" id="I7">I7</div>
                    <div class="square" id="I8">I8</div>
                    <div class="square" id="I9">I9</div>
                    <div class="square" id="I10">I10</div>
                    <div class="square" id="I11">I11</div>
                </div>
                <div id="r">
                    <div class="square" id="J6">J6</div>
                    <div class="square" id="J7">J7</div>
                    <div class="square" id="J8">J8</div>
                    <div class="square" id="J9">J9</div>
                    <div class="square" id="J10">J10</div>
                    <div class="square" id="J11">J11</div>
                </div>
            </div>
        </div>
    </div>

    <!-- <div id="confirmBox" class="confirm-box">
        <p>이 좌석을 택하시겠습니까?</p>
        <button id="yesBtn">선택하기</button>
        <button id="noBtn">돌아가기</button>
    </div> -->

    <script>
        const serverURL = 'http://localhost:3000'; // 서버 URL 설정

        let selectedSquareId = null; // 선택된 좌석 ID안

        document.addEventListener('DOMContentLoaded', () => {
            updateSquares();

            document.querySelectorAll('.square').forEach(square => {
                square.addEventListener('click', () => {
                    // 이미 선택된 좌석이 있는 경우 추가 선택을 막음
                    if (selectedSquareId) {
                        alert('이미 선택된 좌석이 있습니다. 선택을 취소한 후 다시 시도하세요.');
                        return;
                    }

                    const squareId = square.id;
                    fetch('https://teddy-9kuu.onrender.com/get-selected-squares')
                        .then(res => res.json())
                        .then(data => {
                            if (data[squareId]) {
                                if (data[squareId].isOwner) {
                                    window.location.href = `/seat-info.html?seatId=${squareId}&name=${data[squareId].name}`;
                                } else {
                                    alert('이미 선택된 좌석입니다.');
                                }
                            } else {
                                selectedSquareId = squareId; // 선택된 좌석 ID 저장
                                window.location.href = `/ticket/${selectedSquareId}`;
                            }
                        });
                });
            });
        });

        function updateSquares() {
            fetch(`${serverURL}/get-selected-squares`)
                .then(res => res.json())
                .then(data => {
                    for (let squareId in data) {
                        const square = document.getElementById(squareId);
                        if (data[squareId].isOwner) {
                            square.style.backgroundColor = '#90EE90'; // 밝은 초록색
                        } else {
                            square.classList.add('disabled');
                        }
                    }
                });
        }

        // 쿠키 값 읽기 함수
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
        }

        // 페이지 로드 시 사용자 이름을 표시
        const userName = getCookie('userName');
        const welcomeMessage = document.getElementById('welcomeMessage');
        welcomeMessage.textContent = userName ? `${userName}님, 환영합니다!` : '환영합니다!';

        // 뒤로가기 버튼 기능 추가
        document.getElementById('backToLogin').addEventListener('click', function () {
            if (confirm('로그인 페이지로 돌아가시겠습니까?')) {
                window.location.href = '/login.html';
            }
        });
    </script>
</body>

</html>
